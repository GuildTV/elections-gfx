<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="public/css/app.css" />
  </head>

  <body style="position: absolute; float: left; top: 0px; left: 0px; width: 1920px; height: 1080px;">
    <div class="coming-up"></div>

    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="filters hidden">
      <defs>
        <filter id="textBlur">
          <feGaussianBlur id="svg-blur-inner" in="SourceGraphic" stdDeviation="12,0" />
        </filter>
      </defs>
    </svg>

    <!-- Scripts -->
    <script type="text/javascript" src="public/lib/jquery/jquery.js"></script>
    <script type="text/javascript">
      function showNext(){
        if($('.content.hidden').length > 0){
          window.$element = $($('.content.hidden')[0]).removeClass("hidden").addClass('blur');
          window.lastPos = window.$element.offset();
        }
      }

      function loadData(xmlData){
        window.advss = xmlData;
        var templateData = xmlData.childNodes[0];

        $('.coming-up').empty();

        for(var i=0; i< templateData.childNodes.length; i++){
          var row = templateData.childNodes[i];
          var item = row.childNodes[0]
          var value = item.getAttribute('value')

          $('.coming-up').append(
            $('<div>').addClass('content hidden').append(
              $('<div>').addClass('inner').append(
                $('<span>').addClass('bold').html("COMING UP:")
              ).append(" "+value)
            )
          );
        }
      }

      var filters = document.querySelector(".filters"), // the SVG that contains the filters
      defs = filters.querySelector("defs"), // the  element inside the SVG
      blur = defs.querySelector("#textBlur"), // the blur filter
      blurFilter = blur.firstElementChild; // the feGaussianBlur primitive

      // a helper to simplify setting the blur. 
      function setBlur(x){
        blurFilter.setAttribute("stdDeviation",x+",0");  
      }

      // a multiplier, to be able to control the intensity of the effect
      var multiplier=0.25;
      var started = false;

      (function updateBlur(){
        if(!window.$element)
          return requestAnimationFrame(updateBlur);

        // get the current position of the element
        var currentPos=window.$element.offset();

        // calculate the changes from the last frame and apply the multiplier
        var xDiff=Math.abs(currentPos.left-window.lastPos.left)*multiplier;

        if(xDiff == 0 && started){
          $('.content.blur').removeClass('blur');
          window.$element = undefined;
          started = false;
          return requestAnimationFrame(updateBlur);
        }

        if(xDiff > 0)
          started = true;

        // set the blur
        setBlur(xDiff);

        // store current position for the next frame
        window.lastPos=currentPos;

        requestAnimationFrame(updateBlur);
      })();

      <!--
        // the out video animation should be able to deal with hiding the data, before destroying it
      -->

      // CALL 1-1 PLAY
      function play(str) {
        showNext();
      }
      // CALL 1-1 STOP
      function stop(str) {
        $('.content').css('display', 'none !important');
      }
      // CALL 1-1 NEXT
      function next() {
        showNext();
      }
      // CALL 1-1 REMOVE
      function remove() {
        $('.content').css('display', 'none !important');
      }
      // CALL 1-1 UPDATE STRING
      function update(str) {
        var templateData = (new DOMParser()).parseFromString(str,"text/xml");
        loadData(templateData)
      }
      // CALL 1-1 INVOKE STRING
      function invoke(str) {
        eval(str);
      }
      // CALL 1-1 INVOKE "otherFunction('testing');"
      function otherFunction(str) {
      }

      //temporary to fake data (for testing in browser)
      function fake(){
        update("<templateData><componentData id=\"f0\"><data id=\"text\" value=\"9PM PART-TIME OFFICERS\" /></componentData><componentData id=\"f1\"><data id=\"text\" value=\"10PM FULL-TIME OFFICERS\" /></componentData><componentData id=\"f2\"><data id=\"text\" value=\"11PM TIME FOR BED\" /></componentData></templateData>");
      }

    </script>

  </body>
</html>